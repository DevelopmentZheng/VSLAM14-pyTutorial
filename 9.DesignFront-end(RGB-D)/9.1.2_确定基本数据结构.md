&emsp;
# 9.1.2 确定基本数据结构
为了让程序跑起来，我们要设计好数据单元，以及程序处理的流程。这好比构成房屋的一个个的柱子和砖块。那么，在一个 SLAM 程序中，有哪些结构是最基本的呢？我们抽象出几条基本概念：

&emsp;
>帧
- 一个帧是相机采集到的图像单位。它主要包含一个图像（RGB-D 情形下是一对图像）。此外，还有特征点、位姿、内参等信息。

&emsp;
>关键帧（Key-frame）
- 在视觉 SLAM 中我们会谈论关键帧（Key-frame）。由于相机采集的数据很多，存储所有的数据显然是不现实的。不然的话，如果相机放在桌上不动，程序的内存占用也会越来越高最后导致无法接受。

    通常的做法是把某些我们认为更重要的帧保存起来，并认为相机轨迹就可以用这些关键帧来描述。关键帧如何选择是一个很大的问题，而且基于工程经验，很少有理论上的指导。在本书中我们也会使用一个关键帧选择方法，但读者亦可考虑自己提出新的方式。

&emsp;
>路标
- 路标点即图像中的特征点。当相机运动之后，我们还能估计它们的 3D 位置。通常，会把路标点放在一个地图当中，并将新来的帧与地图中的路标点进行匹配，估计相机位姿。

&emsp;

帧的位姿与路标的位置估计相当于一个局部的 SLAM 问题。除此之外，我们还需要一
些工具，让程序写起来更流畅。例如：

&emsp;
>配置文件
- 在写程序中你会经常遇到各种各样的参数，比如
    - 相机的内参
    - 特征点的数量
    - 匹配时选择的比例等等
    
    你可以把这些数写在程序中，但那不是一个好习惯。你会经常修改这些参数，但每次修改后都要重新编译一遍程序。当它们数量越来越多时，修改就变得越来越困难。
    
    所以，更好的方式是在外部定义一个配置文件，程序运行时读取该配置文件中的参数值。这样，每次只要修改配置文件内容就行了，不必对程序本身做任何修改。

&emsp;
>坐标变换
- 你会经常需要在坐标系间进行坐标变换。例如
    - 世界坐标到相机坐标
    - 相机坐标到归一化相机坐标
    - 归一化相机坐标到像素坐标等等
    
    定义一个类把这些操作都放在一起将更方便些。


所以下面我们就来定义帧、路标这几个概念，在 C++ 中都以类来表示。我们尽量保证一个类有单独的头文件和源文件，避免把许多个类放在同一个文件中。然后，把函数声明放在头文件，实现放在源文件里（除非函数很短，也可以写在头文件中）。

我们参照 Google 的命名规范，同时考虑尽量以初学者也能看懂的方式来写程序。

由于我们的程序是偏向算法而非软件工程的，所以不讨论复杂的类继承关系、接口、模板等等，而更应该关注算法的正确实现，以及是否便于扩展。我们会把数据成员设置为公有，尽管这在 C++ 软件设计中是应该避免的，如果读者愿意，也可以把它们改成 private 或 protected 接口，并添加设置和获取接口。在过程较为复杂的算法中，我们会把它分解成若干步骤，例如特征提取和匹配应该分别在不同的函数中实现，这样，当我们想修改算法流程时，就不需要修改整
个运行流程，只需调整局部的处理方式即可。

&emsp;
## 0.1 版本
现在，让我们开始写 VO。我们把这个版本定为 0.1 版，表示这是刚开始的阶段。我们一共写五个类：
- Frame 为帧
- Camera 为相机模型
- MapPoint 为特征点/路标点
- Map 管理特征点
- Config 提供配置参数


它们的关系如图 9-3 所示。我们现在只写它们的数据成员和常用方法，而在后面用到更多内容时，再另行添加新的内容。

<div align="center">
    <image src="./imgs/9.1.2-2.png" width = 500>
</div>
&emsp;

Camera 类最简单，我们先来实现它。

>common_include.h
```c++
#ifndef COMMON_INCLUDE_H
#define COMMON_INCLUDE_H

// define the commonly included file to avoid a long include list

// for Eigen
#include <Eigen/Core>
#include <Eigen/Geometry>
using Eigen::Vector2d;
using Eigen::Vector3d;

// for Sophus
#include <sophus/se3.h>
using Sophus::SE3;
using Sophus::SO3;

// for cv
#include <opencv2/core/core.hpp>
using cv::Mat;

// std 
#include <vector>
#include <list>
#include <memory>
#include <string>
#include <iostream>
#include <set>
#include <unordered_map>
#include <map>

using namespace std;

#endif // COMMON_INCLUDE_H
```