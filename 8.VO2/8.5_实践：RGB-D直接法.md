&emsp;
# 8.5 实践：RGB-D 直接法

## 8.5.1 稀疏直接法

现在，我们来演示如何使用稀疏的直接法。由于本书不涉及 GPU 编程，稠密的直接法就省略掉了。同时，为了保持程序简单，我们使用 RGB-D 数据而非单目数据，这样可以省略掉单目的深度恢复部分。基于特征点的深度恢复已经在上一讲介绍过了，而基于块匹配的深度恢复将在后面章节中介绍。所以本节我们来考虑 RGB-D 上的稀疏直接法 VO。

由于求解直接法最后等价于求解一个优化问题，因此我们可以使用 g2o 或 Ceres 这些优化库帮助我们求解。本节以 g2o 为例设计实验，而 Ceres 部分则留作习题。在使用 g2o之前，需要把直接法抽象成一个图优化问题。显然，直接法是由以下顶点和边组成的：

1. 优化变量为一个相机位姿，因此需要一个位姿顶点。由于我们在推导中使用了李代数，故程序中使用李代数表达的 $SE(3)$ 位姿顶点。与上一章一样，我们将使用“VertexSE3Expmap”作为相机位姿。

2. 误差项为单个像素的光度误差。由于整个优化过程中 $\pmb{I}_1(\pmb{p}_1)$ 保持不变，我们可以把它当成一个固定的预设值，然后调整相机位姿，使 I2(p2) 接近这个值。于是，这种边只连接一个顶点，为一元边。由于 g2o 中本身没有计算光度误差的边，我们需要自己定义一种新的边。

在上述的建模中，直接法图优化问题是由一个相机位姿顶点与许多条一元边组成的。

如果使用稀疏的直接法，那我们大约会有几百至几千条这样的边；稠密直接法则会有几十万条边。优化问题对应的线性方程是计算李代数增量，本身规模不大（6×6），所以主要的计算时间会花费在每条边的误差与雅可比的计算上。下面的实验中，我们先来定义一种用于直接法位姿估计的边，然后，使用该边构建图优化问题并求解之。实验工程位于“slambook/ch8/directMethod”中。

