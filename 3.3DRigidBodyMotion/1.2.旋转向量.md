&emsp;
# 旋转向量

# 1 旋转矩阵的问题
旋转矩阵 $\pmb{R}$ 表示方式至少有以下几个缺点：

$$\pmb{R} = \begin{bmatrix}\pmb{e}_x^T\pmb{e'}_x & \pmb{e}_x^T\pmb{e'}_y  & \pmb{e}_x^T\pmb{e'}_z \\ \\
\pmb{e}_y^T\pmb{e'}_x & \pmb{e}_y^T\pmb{e'}_y  & \pmb{e}_y^T\pmb{e'}_z \\ \\
\pmb{e}_z^T\pmb{e'}_x & \pmb{e}_z^T\pmb{e'}_y  & \pmb{e}_z^T\pmb{e'}_z \end{bmatrix}$$

1. 旋转矩阵有九个量，但一次旋转只用 3 个自由度就够了。是否有更紧凑的表示呢？
2. 旋转矩阵自身带有约束：它必须是个正交矩阵，且行列式为 $1$。当我们想要估计或优化一个旋转矩阵/变换矩阵时，这些约束会使得求解变得更困难

其实，外积就可以表达旋转关系


&emsp;
# 2 向量外积
## 2.1 外积
向量的外积又称为向量积、叉乘


$$\pmb{a} \times \pmb{b} = 
\begin{vmatrix} \pmb{i} & \pmb{j} &\pmb{k} \\
\pmb{a}_1 & \pmb{a}_2 & \pmb{a}_3 \\
\pmb{b}_1 & \pmb{b}_2 & \pmb{b}_3 \\
\end{vmatrix} = \begin{vmatrix} \pmb{a}_y & \pmb{a}_z \\ \pmb{b}_y & \pmb{b}_z \end{vmatrix}\pmb{i} +
\begin{vmatrix} \pmb{a}_z & \pmb{a}_x \\ \pmb{b}_z & \pmb{b}_x \end{vmatrix} \pmb{j} +
\begin{vmatrix} \pmb{a}_x & \pmb{a}_y \\ \pmb{b}_x & \pmb{b}_y \end{vmatrix}\pmb{k}
$$

$$=(\pmb{a}_2 \pmb{b}_3)\pmb{i} + (\pmb{a}_3 \pmb{b}_1)\pmb{j} + (\pmb{a}_1 \pmb{b}_2)\pmb{k} - (\pmb{a}_3 \pmb{b}_2)\pmb{i} - (\pmb{a}_1 \pmb{b}_3)\pmb{j}- (\pmb{a}_2 \pmb{b}_1)\pmb{k}$$


$$\qquad\qquad\qquad\quad\ \ =[\pmb{i}，\pmb{j}，\pmb{k}]\begin{bmatrix}
\pmb{a}_2 \pmb{b}_3 - \pmb{a}_3 \pmb{b}_2 \\ 
\pmb{a}_3 \pmb{b}_1 - \pmb{a}_1 \pmb{b}_3 \\ 
\pmb{a}_1 \pmb{b}_2 - \pmb{a}_2 \pmb{b}_1 \\ 
\end{bmatrix} = \begin{bmatrix}
0 & -\pmb{a}_3 & \pmb{a}_2 \\
\pmb{a}_3 & 0 & -\pmb{a}_1 \\
-\pmb{a}_2 & \pmb{a}_1 & 0\end{bmatrix} \pmb{b} \triangleq \pmb{a}^{\wedge}\pmb{b}$$

- 外积的方向垂直于这两个向量
- $\pmb{a} × \pmb{b} = -\pmb{b} × \pmb{a}$
- 大小为 $|\pmb{a} \times \pmb{b}| =|a|\ |b|\ sin \hat{(\pmb{a}，\pmb{b})}$，是两个向量张成的四边形的有向面积


>向量
```py
import numpy as np

vec1 = np.array([1, 2, 3])
vec2 = np.array([3, 4, 5])

# Calculate the cross product of the vectors
cross_product = np.cross(vec1, vec2)

print(cross_product)
```

>夹角 $\theta$
```py
import numpy as np

# Define the vectors
a = np.array([1, 2, 3])
b = np.array([-2, 0, 1])

# Calculate the dot product of the vectors
dot_product = np.dot(a, b)

# Calculate the magnitudes of the vectors
magnitude_a = np.linalg.norm(a)
magnitude_b = np.linalg.norm(b)

# Calculate the cosine of the angle
cos_angle = dot_product / (magnitude_a * magnitude_b)

# Calculate the angle in radians
angle_rad = np.arccos(cos_angle)

# Convert the angle to degrees
angle_deg = np.degrees(angle_rad)

print("Angle between a and b (in radians):", angle_rad)
print("Angle between a and b (in degrees):", angle_deg)
```


&emsp;
## 2.2 反对称矩阵符号
对于外积，我们引入了 `∧` 符号，把 $\pmb{a}$ 写成一个矩阵。事实上是一个 `反对称矩阵（Skew-symmetric）`，你可以将 `∧` 记成一个反对称符号。

这样就把外积 $\pmb{a} × \pmb{b}$，写成了 `反对称矩阵`$\pmb{a}^∧$ 与 `向量`$\pmb{b}$ 的乘法：
$$\pmb{a} × \pmb{b} = \pmb{a}^∧\pmb{b}$$

把它变成了`线性运算`。这个符号将在后文经常用到，请记住它。外积只对三维向量存在定义，我们还能用外积表示向量的旋转




&emsp;
## 2.3 外积表示旋转

<div align="center">
    <image src="./imgs/3.1-1.png" width = 500>
</div>
&emsp;


在右手法则下，我们用右手的四个指头从 $\pmb{a}$ 转向 $\pmb{b}$
- 旋转向量：大拇指朝向，也是 $\pmb{a} × \pmb{b}$ 的方向
- 旋转角度： $\pmb{a}$ 和 $\pmb{b}$ 的夹角决定。通过这种方式，我们构造了从 $\pmb{a}$ 到 $\pmb{b}$ 的一个旋转向量。这个向量同样位于三维空间中，在此坐标系下，可以用三个实数来描述它。




&emsp;
# 2 旋转向量

我们可以使用一个向量 $\theta \pmb{n}$ 表示旋转：
- $\pmb{n}$: 旋转向量，其方向与旋转轴一致
- $\theta$: 旋转角度

这种向量，称为 `旋转向量`（或 `轴角`，`AxisAngle`）。这种表示法只需一个三维向量即可描述旋转

其实，旋转向量就是 `李代数`



&emsp;
# 3 罗德里格斯公式（Rodrigues’s Formula ）
剩下的问题是，旋转向量和旋转矩阵之间是如何转换的呢？假设有一个旋转向量为 $θ\pmb{n}$
- 旋转轴为 $\pmb{n}$
- 角度为 $θ$ 

&emsp;
>$θ\pmb{n}$ 转 $\pmb{R}$
- 由 `旋转向量` 到 `旋转矩阵` 的过程由罗德里格斯公式（Rodrigues’s Formula ）表明，由于推导过程比较复杂，我们不作描述，只给出转换的结果：
    $$\pmb{R} = cos θ\pmb{I} + (1 - cos θ) \pmb{nn}^T + sin θ\pmb{n}^∧$$

    - 符号 `∧` 是向量到反对称的转换符

&emsp;  
>$\pmb{R}$ 转 $θ\pmb{n}$
- 反之，我们也可以计算从一个旋转矩阵到旋转向量的转换。
    - 对于转角 $θ$，有：

        $tr(\pmb{R}) = cos θ\ tr(\pmb{I}) + (1 - cos θ)\ tr(\pmb{nn}^T) + sin θ\ tr(\pmb{n}^∧)$

        $\qquad\ \ \ = 3 cos θ + (1 - cos θ)$

        $\qquad\ \ \ = 1 + 2 cos θ$

        因此：
        $$θ = arccos(\frac{tr(R)-1}{2})$$
    - 关于转轴 $\pmb{n}$，由于旋转轴上的向量在旋转后不发生改变，说明
    $$\pmb{Rn} = \pmb{n}$$
    因此，转轴 $\pmb{n}$ 是矩阵 $\pmb{R}$ 特征值 $1$ 对应的特征向量。求解此方程，再归一化，就得到了旋转轴。读者也可以从“旋转轴经过旋转之后不变”的几何角度看待这个方程。仍然剧透几句，这里的两个转换公式在下一章仍将出现，你会发现它们正是 `SO(3)` 上`李群与李代数`的对应关系。

