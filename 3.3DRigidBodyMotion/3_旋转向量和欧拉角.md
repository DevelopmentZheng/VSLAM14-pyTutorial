&emsp;
# 3.3 旋转向量和欧拉角

## 1 旋转向量

有了旋转矩阵来描述旋转，有了变换矩阵描述一个六自由度的三维刚体运动，是不是已经足够了呢？但是，矩阵表示方式至少有以下几个缺点：
1. $SO(3)$ 的旋转矩阵有九个量，但一次旋转只有三个自由度。因此这种表达方式是冗余的。同理，变换矩阵用十六个量表达了六自由度的变换。那么，是否有更紧凑的表示呢？
2. 旋转矩阵自身带有约束：它必须是个正交矩阵，且行列式为 1。变换矩阵也是如此。当我们想要估计或优化一个旋转矩阵/变换矩阵时，这些约束会使得求解变得更困难。

因此，我们希望有一种方式能够紧凑地描述旋转和平移。例如，用一个三维向量表达旋转，用六维向量表达变换，可行吗？

&emsp;
>旋转向量
- 事实上，这件事我们在前面介绍外积的那部分，提到过这件事如何做。我们介绍了如何用外积表达两个向量的旋转关系。对于坐标系的旋转，我们知道，任意旋转都可以用一个旋转轴和一个旋转角来刻画。

    于是，我们可以使用一个向量
    - 其方向与旋转轴一致
    - 长度等于旋转角。

    这种向量，称为`旋转向量`（或`轴角`，`AxisAngle`）。这种表示法只需一个三维向量即可描述旋转。同样，对于变换矩阵，我们使用一个旋转向量和一个平移向量即可表达一次变换。这时的维数正好是六维。

    事实上，旋转向量就是我们下章准备介绍的 `李代数`。所以我们把它的详细内容留到下一章，本章内读者只需知道旋转可以这样表示即可。

&emsp;
## 2 罗德里格斯公式（Rodrigues’s Formula ）
剩下的问题是，旋转向量和旋转矩阵之间是如何转换的呢？假设有一个旋转向量为 $θ\pmb{n}$
- 旋转轴为 $\pmb{n}$
- 角度为 $θ$ 

&emsp;
>$θ\pmb{n}$ 转 $\pmb{R}$
- 由 `旋转向量` 到 `旋转矩阵` 的过程由罗德里格斯公式（Rodrigues’s Formula ）表明，由于推导过程比较复杂，我们不作描述，只给出转换的结果：
    $$\pmb{R} = cos θ\pmb{I} + (1 - cos θ) \pmb{nn}^T + sin θ\pmb{n}^∧$$

    - 符号 `∧` 是向量到反对称的转换符

&emsp;  
>$\pmb{R}$ 转 $θ\pmb{n}$
- 反之，我们也可以计算从一个旋转矩阵到旋转向量的转换。
    - 对于转角 $θ$，有：

        $tr(\pmb{R}) = cos θ\ tr(\pmb{I}) + (1 - cos θ)\ tr(\pmb{nn}^T) + sin θ\ tr(\pmb{n}^∧)$

        $\qquad\ \ \ = 3 cos θ + (1 - cos θ)$

        $\qquad\ \ \ = 1 + 2 cos θ$

        因此：
        $$θ = arccos(\frac{tr(R)-1}{2})$$
    - 关于转轴 $\pmb{n}$，由于旋转轴上的向量在旋转后不发生改变，说明
    $$\pmb{Rn} = \pmb{n}$$
    因此，转轴 $\pmb{n}$ 是矩阵 $\pmb{R}$ 特征值 $1$ 对应的特征向量。求解此方程，再归一化，就得到了旋转轴。读者也可以从“旋转轴经过旋转之后不变”的几何角度看待这个方程。仍然剧透几句，这里的两个转换公式在下一章仍将出现，你会发现它们正是 `SO(3)` 上`李群与李代数`的对应关系。

&emsp;
## 3 欧拉角

无论是旋转矩阵、旋转向量，虽然它们能描述旋转，但对我们人类是非常不直观的。当我们看到一个旋转矩阵或旋转向量时，很难想象出来这个旋转究竟是什么样的。当它们变换时，我们也不知道物体是向哪个方向在转动。

而欧拉角则提供了一种非常直观的方式来描述旋转——它使用了三个分离的转角，把一个旋转分解成三次绕不同轴的旋转。当然，由于分解方式有许多种，所以欧拉角也存在着不同的定义方法。

比如说，当我先绕 $X$ 轴旋转，再绕 $Y$ 轴，最后绕 $Z$ 轴，就得到了一个 $XY Z$ 轴的旋转。同理，可以定义 $ZY Z$、$ZY X$ 等等旋转方式。如果讨论更细一些，还需要区分每次旋转是绕 `固定轴` 旋转的，还是绕 `旋转之后的轴` 旋转的，这也会给出不一样的定义方式。

&emsp;
>偏航-俯仰-滚转”（yaw-pitch-roll）
- 你或许在航空、航模中听说过“俯仰角”、“偏航角”这些词。欧拉角当中比较常用的一种，便是用“偏航-俯仰-滚转”（yaw-pitch-roll）三个角度来描述一个旋转的。

    由于它等价于 $ZY X$ 轴的旋转，我们就以 $ZY X$ 为例。假设一个刚体的前方（朝向我们的方向）为 $X$ 轴，右侧为 $Y$ 轴，上方为 $Z$ 轴，见图 3-3。那么，$ZY X$ 转角相当于把任意旋转分解成以下三个轴上的转角：
    - 绕物体的 $Z$ 轴旋转，得到偏航角 $yaw$
    - 绕旋转之后的 $Y$ 轴旋转，得到俯仰角 $pitch$
    - 绕旋转之后的 $X$ 轴旋转，得到滚转角 $roll$

    &emsp;
    
    此时，我们可以使用 $[r, p, y]^T$ 这样一个三维的向量描述任意旋转。这个向量十分的直观，我们可以从这个向量想象出旋转的过程。其他的欧拉角亦是通过这种方式，把旋转分解到三个轴上，得到一个三维的向量，只不过选用的轴，以及选用的顺序不一样。

    这里介绍的 $rpy$ 角是比较常用的一种，只有很少的欧拉角种类会有 $rpy$ 那样脍炙人口的名字。不同的欧拉角是按照旋转轴的顺序来称呼的。例如，$rpy$ 角的旋转顺序是 $ZY X$。同样，也有 $XY Z$, $ZY Z$ 这样欧拉角——但是它们就没有专门的名字了。

    值得一提的是，大部分领域在使用欧拉角时有各自的坐标方向和顺序上的习惯，不一定和我们这里说的相同。

&emsp;
>万向锁问题（Gimbal Lock）
- 欧拉角的一个重大缺点是会碰到著名的 `万向锁问题（Gimbal Lock）`：在俯仰角为 $±90◦$ 时，第一次旋转与第三次旋转将使用同一个轴，使得系统丢失了一个自由度（由三次旋转变成了两次旋转）。这被称为奇异性问题，在其他形式的欧拉角中也同样存在。

    理论上可以证明，只要我们想用三个实数来表达三维旋转时，都会不可避免地碰到奇异性问题。

    由于这种原理，欧拉角不适于 `插值` 和 `迭代`，往往只用于人机交互中。我们也很少在 SLAM 程序中直接使用欧拉角表达姿态，同样不会在 `滤波` 或 `优化` 中使用欧拉角表达旋转（因为它具有奇异性）。不过，若你想验证自己算法是否有错时，转换成欧拉角能够快速辨认结果的正确与否。




