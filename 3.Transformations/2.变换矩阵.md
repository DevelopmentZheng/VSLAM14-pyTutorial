&emsp;
# 变换矩阵 Transformation Matrix

&emsp;
## 1.2 坐标系之间的欧式变换
与向量间的旋转类似，我们同样可以描述两个坐标系之间的旋转关系，再加上平移，统称为`坐标系之间的变换关系`。

<div align="center">
    <image src="./imgs/3.1-2.png" width = 500>
</div>
&emsp;

>世界坐标系（惯性坐标系）
- 在机器人的运动过程中，常见的做法是设定一个惯性坐标系（或者叫世界坐标系），可以认为它是 `固定不动的（相对的）`，例如图 3-2 中的 $x_W , y_W , z_W$ 定义的坐标系。向量 $\pmb{p} = \overrightarrow{O_wP}$

>世界坐标系的选取
- 在实践中，世界坐标系的选取可分为两种情况，单目相机与双目相机。

    - `单目相机`：在单目相机中，我们通常选择拍摄第一张图像时的相机坐标系作为世界坐标系，即以拍摄第一张图像时相机的光心（小孔）作为原点，X轴为水平方向，Y轴为竖直方向，Z轴指向拍摄第一张图像时相机所观察的方向。选定后世界坐标系便不再发生变化，即不变且唯一。

    - `双目相机`：在双目相机(A,B)中，与单目相机大同小异，我们可选取其中一个相机A拍摄第一张图像时的相机坐标系为世界坐标系，即以相机A拍摄第一张图像时相机的光心（小孔）作为原点，X轴为水平方向，Y轴为竖直方向，Z轴指向拍摄第一张图像时相机A所观察的方向。

>移动坐标系（相机坐标系）
- 同时，相机或机器人则是一个移动坐标系，例如 $x_C , y_C , z_C$ 定义的坐标系。向量 $\pmb{p} = \overrightarrow{O_cP}$

>转换矩阵$T$
- 我们会问：相机视野中某个向量 $\pmb{p}$，它的坐标为 $\pmb{p}_c$，而从世界坐标系下看，它的坐标 $\pmb{p}_w$。这两个坐标之间是如何转换的呢？这时，就需要先得到该点针对机器人坐标系坐标值，再根据机器人位姿转换到世界坐标系中，这个转换关系由一个矩阵 $T$ 来描述，如图 3-2 所示。

&emsp;
>欧式变换
- 相机运动是一个刚体运动，它保证了同一个向量在各个坐标系下的长度和夹角都不会发生变化。这种变换称为 `欧氏变换`。

    想象你把手机抛到空中，在它落地摔碎之前，只可能有`空间位置`和`姿态`的不同，而它自己的`长度`、`各个面的角度等性质`不会有任何变化。这样一个欧氏变换由两部分组成：
    - 一个旋转
    - 一个平移





&emsp;
### （2）坐标系的平移
在欧氏变换中，除了旋转之外还有一个平移。考虑世界坐标系中的向量 $\pmb{a}$，经过一次旋转（用 $\pmb{R}$ 描述）和一次平移 $\pmb{t}$ 后，得到了 $\pmb{a}'$，那么把旋转和平移合到一起，有：
    $$\pmb{a}' = \pmb{R}\pmb{a} + \pmb{t}$$

其中，$\pmb{t}$ 称为`平移向量`。相比于旋转，平移部分只需把这个平移量加到旋转之后的坐标上，显得非常简洁。通过上式，我们用一个旋转矩阵 $\pmb{R}$ 和一个平移向量 $\pmb{t}$ 完整地描述了一个欧氏空间的坐标变换关系。


&emsp;
## 1.3 变换矩阵与齐次坐标


>齐次坐标
- 齐次坐标：https://www.bilibili.com/video/BV1LS4y1b7xZ?spm_id_from=333.337.search-card.all.click&vd_source=ead820d10887c21595d014f264bcbb35

    稍微来说一下齐次坐标。它是射影几何里的概念。通过添加最后一维，我们用四个实数描述了一个三维向量，这显然多了一个自由度，但允许我们把变换写成线性的形式。在齐次坐标中，某个点 $x$ 的每个分量同乘一个非零常数 $k$ 后，仍然表示的是同一个点。因此，一个点的具体坐标值不是唯一的。如 $[1, 1, 1, 1]^T$ 和 $[2, 2, 2, 2]^T$ 是同一个点。但当最后一项不为零时，我们总可以把所有坐标除以最后一项，强制最后一项为 $1$，从而得到一个点唯一的坐标表示（也就是转换成非齐次坐标）：

    $$\tilde{x} = [x, y, z, w]^T = [x/w, y/w, z/w, 1]^T$$
    这时，忽略掉最后一项，这个点的坐标和欧氏空间就是一样的。依靠齐次坐标和变换矩阵，两次变换的累加就可以有很好的形式：
    $$\tilde{b} = \pmb{T}_1\tilde{a}， \tilde{c} = \pmb{T}_2\tilde{b} \quad \Rightarrow \quad \tilde{c} = \pmb{T}_2\pmb{T}_1 \tilde{a}$$

    但是区分齐次和非齐次坐标的符号令我们厌烦。在不引起歧义的情况下，以后我们就直接把它写成 $\pmb{b} = \pmb{T} \pmb{a}$ 的样子，默认其中是齐次坐标了。


$\pmb{a}' = \pmb{R}\pmb{a} + \pmb{t}$ 完整地表达了欧氏空间的旋转与平移，不过还存在一个小问题：这里的变换关系不是一个线性关系。假设 $\pmb{a}$ 进行了两次变换，变换为 $\pmb{c}$：$\pmb{R}_1$, $\pmb{t}_1$ 和 $\pmb{R}_2$, $\pmb{t}_2$ ：

$$\pmb{b} = \pmb{R}_1\pmb{a} + \pmb{t}_1，\pmb{c} = \pmb{R}_2\pmb{b} + \pmb{t}_2$$

这样的形式在变换多次之后会过于复杂。因此，我们要引入`齐次坐标` 和 `变换矩阵` 重写 $\pmb{a}' = \pmb{R}\pmb{a} + \pmb{t}$ 这个式子（改成矩阵乘法的形式）：

$$\begin{bmatrix} \pmb{a'} \\ \\ 1\end{bmatrix} = 
\begin{bmatrix} \pmb{R} & \pmb{t} \\ \\ 
0^T & 1\end{bmatrix} \begin{bmatrix} \pmb{a} \\ \\ 1\end{bmatrix}\triangleq
\pmb{T}\begin{bmatrix} \pmb{a} \\\\ 1\end{bmatrix} \quad (3.9)$$

这是一个数学技巧：我们把一个三维向量的末尾添加 $1$，变成了四维向量，称为`齐次坐标`。对于这个四维向量，我们可以把旋转和平移写在一个矩阵里面，使得整个关系变成了线性关系。该式中，矩阵 $\pmb{T}$ 称为 `变换矩阵（Transform Matrix）`。

我们暂时用 $\pmb{a}˜$ 表示 $\pmb{a}$ 的齐次坐标。

>变换矩阵 $T$ 的其它含义
- 以 $T_{CW}$ 为例
    $$[\ \pmb{R}\qquad \pmb{t}\ ] = [\pmb{X}\ \pmb{Y}\ \pmb{Z}\quad t ] = \begin{bmatrix}
    x_1 & y_1 & z_1 & t_1 \\
    x_2 & y_2 & z_2 & t_2 \\
    x_3 & y_3 & z_3 & t_3 \\
    \end{bmatrix}$$
    - $\pmb{X}\ \pmb{Y}\ \pmb{Z}$: 分别代表相机坐标系 $C$ 的 x, y, z 轴在世界坐标系 $W$ 下对应的方向
    - $\pmb{t}$: 相机原点在世界坐标系的对应位置


&emsp;
>$SE(3)$ 特殊欧式群
- 关于变换矩阵 $\pmb{T}$，它具有比较特别的结构：
    - 左上角为旋转矩阵
    - 右侧为平移向量
    - 左下角为 $\pmb{0}$ 向量
    - 右下角为 $1$

    这种矩阵又称为 `特殊欧氏群（Special Euclidean Group）`：
    $$SE(3) = \begin{Bmatrix}\pmb{T}=\begin{bmatrix}
    \pmb{R} & \pmb{t} \\ \pmb{0}^T & 1\end{bmatrix} \in \mathbb{R}^{4\times 4}|\pmb{R} \in SO(3)，\pmb{t} \in \mathbb{R}^3\end{Bmatrix}$$

    与 $SO(3)$ 一样，求解该矩阵的逆表示一个反向的变换：
    $$\pmb{T}^{-1} = \begin{bmatrix}
    \pmb{R}^T & -\pmb{R}^T\pmb{t} \\ 0^T & 1
    \end{bmatrix}$$

最后，为了保持符号的简洁，在不引起歧义的情况下，我们以后不区别齐次坐标与普通的坐标的符号，默认我们使用的是符合运算法则的那一种。

例如
- 写 $\pmb{Ta}$ 时，使用的是齐次坐标（不然没法计算）
- 写 $\pmb{Ra}$ 时，使用的是非齐次坐标。
- 如果写在一个等式中，我们就假设齐次坐标到普通坐标的转换，是已经做好了的——因为齐次坐标和非齐次坐标之间的转换事实上非常容易。


回顾一下我们介绍的内容：
- 首先，我们说了向量和它的坐标表示，并介绍了向量间的运算
- 然后，坐标系之间的运动由 `欧氏变换` 描述，它由 `平移` 和 `旋转` 组成
    - 旋转可以由旋转矩阵` SO(3)（特殊正交群）` 描述
    - 平移直接由一个 $\mathbb{R}^3$ 向量描述
- 最后，如果将平移和旋转放在一个矩阵中，就形成了变换矩阵 `SE(3)（特殊欧式群）`。